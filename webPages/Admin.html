<!--Page pour les admins, à améliorer pour gérer commentaires, articles, connexion...-->

<!--Connecte à base de données + début gérer accès membres-->
<?php
session_start();
$bdd = new PDO("mysql:host=127.0.0.1;dbname=espace_membre;charset=utf8", "root", "");

if(!isset($_SESSION['admin']) OR $_SESSION['admin'] != 1 OR !isset($_SESSION)) {
    header("Location: main.html");
}

if(isset($_GET['type']) AND $_GET['type'] == 'membre') {
    if(isset($_GET['admin']) AND !empty($_GET['admin'])) {

        $admin = (int) $_GET['admin'];
        $req = $bdd->prepare('UPDATE membres SET admin = 1 WHERE id = ?');
        $req->execute(array($admin));
        $nadmin = $bdd->query('SELECT * FROM membres');
        $newadmin = $nadmin->fetch();

        $_SESSION['admin'] = $newadmin['admin'];
    }
}

if(isset($_GET['type']) AND $_GET['type'] == 'membre') {
    if(isset($_GET['confirmer']) AND !empty($_GET['confirmer'])) {

        $confirmer = (int) $_GET['confirmer'];
        $req = $bdd->prepare('UPDATE membres SET confirmer = 1 WHERE id = ?');
        $req->execute(array($confirmer));
        $nconf = $bdd->query('SELECT * FROM membres');
        $newconf = $nconf->fetch();
        $_SESSION['confirmer'] = $newconf['confirmer'];
    }
}

if(isset($_GET['supprime']) AND !empty($_GET['supprime'])) {
    $supprime = (int) $_GET['supprime'];
    $req = $bdd->prepare('DELETE FROM membres WHERE id = ?');
    $req->execute(array($supprime));
}

$membres = $bdd->query('SELECT * FROM membres ORDER BY id DESC');

?>

    <!DOCTYPE html>
    <html>

    <head>
        <!--Pour mettre des commentaires dans le code, respecter ma syntaxe-->
        <meta charset="UTF-8">
        <!-- Paramètre d'affichage mobile -->
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
        <!-- Gestion du navigateur IE -->
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>Admin</title>
        <!--Appliquer le style css et importer l'icone-->
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&display=swap" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="style.css" />
        <link rel="icon" href="assets/Inflow_logo_64px.png" />
        <script src="jquery-3.6.0.min.js"></script>
        <script type="text/javascript" src="script.js"></script>
    </head>

    <body>
        <div class="main container">
            <!--Header, c'est-à-dire, le menu pour changer de page-->
            <header class="header container">
                <img class="bannière element" src="assets/banniere_twi.png" />
                <nav class="menu container element">
                    <div class="element menuElement"><a href="main.html">Menu</a></div>
                    <div class="element dropdown menuElement">
                        <a href="#">Article</a>
                        <div class="dropdown-content">
                            <div class="menuElement"><a href="Article.html">Article</a></div>
                            <?php if(isset($_SESSION['confirmer']) AND $_SESSION['confirmer'] == 1 AND isset($_SESSION)) { ?>
                            <div class="menuElement">
                                <a href="Poster.html">Poster</a>
                                <?php } ?>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="element menuElement"><a href="Playlist.html">Playlist</a></div>
                <div class="element dropdown menuElement"><a href="#">Espace Membre</a>
                    <div class="dropdown-content">
                        <div class="menuElement"><a href="Inscription.html">Inscription</a></div>
                        <?php if(empty($_SESSION)) { ?>
                        <div class="menuElement">
                            <a href="Connexion.html">Connexion</a></div>
                        <?php } ?>
                        <?php if(!empty($_SESSION)) { ?>
                        <div class="menuElement">
                            <a href="Profil.html?id=<?= $_SESSION['id'] ?>">Profil</a></div>
                        <?php } ?>
                        <?php if(isset($_SESSION['admin']) AND $_SESSION['admin'] == 1 AND isset($_SESSION)) { ?>
                        <div class="menuElement">
                            <a href="Admin.html" class="selected">Admin</a>
                            </div>
                        </div>
                    </div>
                    <div class="element menuElement"><a href="Infos.html" id="Infos">Infos</a></div>
                    <!-- search bar right align -->
                    <div class="element search">
                        <form action="#">
                            <input type="text" placeholder="Recherche" name="search">
                            <button>
                            </button>
                        </form>
                    </div>
                </nav>
            </header>

            <div class="left"></div>

            <!--Début de là où on pourra mettre du texte-->
            <div class="middle">
                <ul>
                    <?php while($m = $membres->fetch()) { ?>
                    <li>
                        <?= $m['id'] ?> :
                        <?= $m['pseudo'] ?>
                        <?php if($m['admin'] == 0) { ?> - <a href="Admin.html?type=membre&admin=<?= $m['id'] ?>">Admin</a>
                        <?php } ?>
                        <?php if($m['confirmer'] == 0) { ?> - <a href="Admin.html?type=membre&confirmer=<?= $m['id'] ?>">Rédacteur</a>
                        <?php } ?>
                        <?php if($m['admin'] == 0) { ?> - <a href="Admin.html?type=membre&supprime=<?= $m['id'] ?>">Supprimer</a>
                        <?php } ?>
                    </li>
                    <?php } ?>
                </ul>
            </div>

            <div class="right"></div>

            <!--Tout en bas de la page web, contient des infos-->
            <footer class="footer container">
                <p class="element"> Articles et actus sur le rap - <i>Axelito à l'origine</i> - <a href="https://discord.com/channels/826440352810139678/826491405856800788" style="color: white">Rejoignez le Discord !</a></p>
                <button id="darkTrigger" class="btn element">Thème sombre</button>

            </footer>

        </div>
    </body>

    </html>